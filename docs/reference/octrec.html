<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Optimal combination cross-temporal forecast reconciliation — octrec • FoReco026</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Optimal combination cross-temporal forecast reconciliation — octrec"><meta property="og:description" content="

Optimal (in least squares sense) combination cross-temporal forecast
reconciliation. The reconciled forecasts are calculated either through a
projection approach (Byron, 1978), or the equivalent structural approach
by Hyndman et al. (2011)."><meta property="og:image" content="https://danigiro.github.io/FoReco026/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FoReco026</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.2.6.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FoReco_package.html">Using the FoReco package</a>
    </li>
    <li>
      <a href="../articles/accuracy_indices.html">Average relative accuracy indices</a>
    </li>
    <li>
      <a href="../articles/FoReco_prob.html">Probabilistic forecast reconciliation</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/daniGiro/FoReco" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://cran.r-project.org/web/packages/FoReco/index.html" class="external-link">
    <span class="fab fa-r-project fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Optimal combination cross-temporal forecast reconciliation</h1>
    <small class="dont-index">Source: <a href="https://github.com/daniGiro/FoReco026/blob/HEAD/R/octrec.R" class="external-link"><code>R/octrec.R</code></a></small>
    <div class="hidden name"><code>octrec.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>

Optimal (in least squares sense) combination cross-temporal forecast
reconciliation. The reconciled forecasts are calculated either through a
projection approach (Byron, 1978), or the equivalent structural approach
by Hyndman et al. (2011).</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">octrec</span><span class="op">(</span><span class="va">basef</span>, <span class="va">m</span>, <span class="va">C</span>, <span class="va">comb</span>, <span class="va">res</span>, <span class="va">Ut</span>, <span class="va">nb</span>, mse <span class="op">=</span> <span class="cn">TRUE</span>, corpcor <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       type <span class="op">=</span> <span class="st">"M"</span>, sol <span class="op">=</span> <span class="st">"direct"</span>, keep <span class="op">=</span> <span class="st">"list"</span>, v <span class="op">=</span> <span class="cn">NULL</span>, nn <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>       nn_type <span class="op">=</span> <span class="st">"osqp"</span>, settings <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span>, bounds <span class="op">=</span> <span class="cn">NULL</span>, W <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>       Omega <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>basef</dt>
<dd><p>(<em></em>\(n \times h(k^\ast+m)\)) matrix of base forecasts to be
reconciled, <em></em>\(\widehat{\mathbf{Y}}\); <em></em>\(n\) is the total number of variables,
<em></em>\(m\) is the highest time frequency, <em></em>\(k^\ast\) is the sum of (a
subset of) (<em></em>\(p-1\)) factors of <em></em>\(m\), excluding <em></em>\(m\), and
<em></em>\(h\) is the forecast horizon for the lowest frequency time series.
Each row identifies a time series, and the forecasts are ordered as
[lowest_freq' ...  highest_freq']'.</p></dd>


<dt>m</dt>
<dd><p>Highest available sampling frequency per seasonal cycle (max. order
of temporal aggregation, <em></em>\(m\)), or a subset of <em></em>\(p\) factors
of <em></em>\(m\).</p></dd>


<dt>C</dt>
<dd><p>(<em></em>\(n_a \times n_b\)) cross-sectional (contemporaneous) matrix
mapping the bottom level series into the higher level ones.</p></dd>


<dt>comb</dt>
<dd><p>Type of the reconciliation. It corresponds to a specific
(<em></em>\(n(k\ast + m) \times n(k^\ast + m)\)) covariance matrix (Di Fonzo and Girolimetto 2023,
Girolimetto et al. 2023), where <em></em>\(k^\ast\) is the sum of (a subset of) (<em></em>\(p-1\))
factors of <em></em>\(m\) (<em></em>\(m\) is not considered) and <em></em>\(n\) is the number
of variables:</p><ul><li><p><b>ols</b> (Identity);</p></li>
<li><p><b>struc</b> (Cross-temporal structural variances);</p></li>
<li><p><b>cs_struc</b> (Cross-sectional structural variances and temporal independence);</p></li>
<li><p><b>t_struc</b> (Cross-sectional independence and temporal structural variances);</p></li>
<li><p><b>wlsh</b> (Hierarchy variances);</p></li>
<li><p><b>wlsv</b> (Series variances);</p></li>
<li><p><b>bdshr</b> (Shrunk cross-covariance matrix, cross-sectional framework);</p></li>
<li><p><b>bdsam</b> (Sample cross-covariance matrix, cross-sectional framework);</p></li>
<li><p><b>acov</b> (Series auto-covariance matrix);</p></li>
<li><p><b>Sshr</b> (Series shrunk cross-covariance matrix);</p></li>
<li><p><b>Ssam</b> (Series cross-covariance matrix);</p></li>
<li><p><b>shr</b> (Shrunk cross-covariance matrix);</p></li>
<li><p><b>sam</b> (Sample cross-covariance matrix);</p></li>
<li><p><b>hbshr</b> (Shrunk high frequency bottom time series cross-covariance matrix);</p></li>
<li><p><b>hbsam</b> (Sample high frequency bottom time series cross-covariance matrix);</p></li>
<li><p><b>bshr</b> (Shrunk bottom time series cross-covariance matrix);</p></li>
<li><p><b>bsam</b> (Sample bottom time series cross-covariance matrix);</p></li>
<li><p><b>hshr</b> (Shrunk high frequency cross-covariance matrix);</p></li>
<li><p><b>hsam</b> (Sample high frequency cross-covariance matrix);</p></li>
<li><p><b>w</b> use your personal matrix W in param <code>W</code>;</p></li>
<li><p><b>omega</b> use your personal matrix Omega in param <code>Omega</code>.</p></li>
</ul></dd>


<dt>res</dt>
<dd><p>(<em></em>\(n \times N(k^\ast + m)\)) matrix containing the residuals at
all the temporal frequencies ordered [lowest_freq' ...  highest_freq']'
(columns) for each variable (row), needed to estimate the covariance matrix.</p></dd>


<dt>Ut</dt>
<dd><p>Zero constraints cross-sectional (contemporaneous) kernel matrix
<em></em>\((\textbf{U}'\textbf{y} = \mathbf{0})\) spanning the null space valid
for the reconciled forecasts. It can be used instead of parameter
<code>C</code>, but <code>nb</code> (<em></em>\(n = n_a + n_b\)) is needed if
<em></em>\(\textbf{U}' \neq [\textbf{I} \ -\textbf{C}]\). If the hierarchy
admits a structural representation, <em></em>\(\textbf{U}'\) has dimension
(<em></em>\(n_a \times n\)).</p></dd>


<dt>nb</dt>
<dd><p>Number of bottom time series; if <code>C</code> is present, <code>nb</code>
and <code>Ut</code> are not used.</p></dd>


<dt>mse</dt>
<dd><p>Logical value: <code>TRUE</code> (<em>default</em>) calculates the
covariance matrix of the in-sample residuals (when necessary) according to
the original <span class="pkg">hts</span> and <span class="pkg">thief</span> formulation: no mean correction,
T as denominator.</p></dd>


<dt>corpcor</dt>
<dd><p>Logical value: <code>TRUE</code> if <span class="pkg">corpcor</span> (Schäfer et
al., 2017) must be used to shrink the sample covariance matrix according to
Schäfer and Strimmer (2005), otherwise the function uses the
same implementation as package <span class="pkg">hts</span>.</p></dd>


<dt>type</dt>
<dd><p>Approach used to compute the reconciled forecasts: <code>"M"</code> for
the projection approach with matrix M (<em>default</em>), or <code>"S"</code> for the
structural approach with summing matrix S.</p></dd>


<dt>sol</dt>
<dd><p>Solution technique for the reconciliation problem: either
<code>"direct"</code> (<em>default</em>) for the closed-form matrix solution, or
<code>"osqp"</code> for the numerical solution (solving a linearly constrained
quadratic program using <code><a href="https://rdrr.io/pkg/osqp/man/solve_osqp.html" class="external-link">solve_osqp</a></code>).</p></dd>


<dt>keep</dt>
<dd><p>Return a list object of the reconciled forecasts at all levels
(if keep = "list") or only the reconciled forecasts matrix (if keep = "recf").</p></dd>


<dt>v</dt>
<dd><p>vector index of the fixed base forecast (<em></em>\(\mbox{min}(v) &gt; 0\)
and <em></em>\(\mbox{max}(v) </p></dd>


<dt>nn</dt>
<dd><p>Logical value: <code>TRUE</code> if non-negative reconciled forecasts
are wished.</p></dd>


<dt>nn_type</dt>
<dd><p>"osqp" (default), "KAnn" (only <code>type == "M"</code>) or "sntz".</p></dd>


<dt>settings</dt>
<dd><p>Settings for <span class="pkg">osqp</span> (object <code><a href="https://rdrr.io/pkg/osqp/man/osqpSettings.html" class="external-link">osqpSettings</a></code>).
The default options are: <code>verbose = FALSE</code>, <code>eps_abs = 1e-5</code>,
<code>eps_rel = 1e-5</code>, <code>polish_refine_iter = 100</code> and <code>polish = TRUE</code>.
For details, see the <a href="https://osqp.org/" class="external-link"><span class="pkg">osqp</span> documentation</a>
(Stellato et al., 2019).</p></dd>


<dt>bounds</dt>
<dd><p>(<em></em>\(n(k^\ast + m) \times 2\)) matrix of the bounds on the
variables: the first column is the lower bound, and the second column is the
upper bound.</p></dd>


<dt>W, Omega</dt>
<dd><p>This option permits to directly enter the covariance matrix:</p><ol><li><p><code>W</code> must be a p.d. (<em></em>\(n(k^\ast + m) \times n(k^\ast + m)\))
  matrix or a list of <em></em>\(h\) matrix (one for each forecast horizon);</p></li>
<li><p><code>Omega</code> must be a p.d. (<em></em>\(n(k^\ast + m) \times n(k^\ast + m)\))
  matrix or a list of <code>h</code> matrix (one for each forecast horizon);</p></li>
<li><p>if <code>comb</code> is different from "<code>w</code>" or "<code>omega</code>",
  <code>W</code> or <code>Omega</code> is not used.</p></li>
</ol></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>If the parameter <code>keep</code> is equal to <code>"recf"</code>, then the function
returns only the (<em></em>\(n \times h(k^\ast + m)\)) reconciled forecasts
matrix, otherwise (<code>keep="all"</code>) it returns a list that mainly depends
on what type of representation (<code>type</code>) and solution technique
(<code>sol</code>) have been used:</p>
<dl><dt><code>recf</code></dt>
<dd><p>(<em></em>\(n \times h(k^\ast + m)\)) reconciled forecasts matrix, <em></em>\(\widetilde{\textbf{Y}}\).</p></dd>

<dt><code>Omega</code></dt>
<dd><p>Covariance matrix used for reconciled forecasts (<em></em>\(\mbox{vec}(\widehat{\textbf{Y}}')\) representation).</p></dd>

<dt><code>W</code></dt>
<dd><p>Covariance matrix used for reconciled forecasts (<em></em>\(\mbox{vec}(\widehat{\textbf{Y}})\) representation).</p></dd>

<dt><code>nn_check</code></dt>
<dd><p>Number of negative values (if zero, there are no values below zero).</p></dd>

<dt><code>rec_check</code></dt>
<dd><p>Logical value: <code>rec_check = TRUE</code> when the constraints have been fulfilled.</p></dd>

<dt><code>varf</code> (<code>type="direct"</code>)</dt>
<dd><p>(<em></em>\(n \times (k^\ast + m)\)) reconciled forecasts variance matrix for <em></em>\(h=1\), <em></em>\(\mbox{diag}(\mathbf{MW}\)).</p></dd>

<dt><code>M</code> (<code>type="direct"</code>)</dt>
<dd><p>Projection matrix (projection approach).</p></dd>

<dt><code>G</code> (<code>type="S"</code> and <code>type="direct"</code>)</dt>
<dd><p>Projection matrix (structural approach, <em></em>\(\mathbf{M}=\mathbf{S}\mathbf{G}\)).</p></dd>

<dt><code>S</code> (<code>type="S"</code> and <code>type="direct"</code>)</dt>
<dd><p>Cross-temporal summing matrix (<em></em>\(\widetilde{\textbf{F}}\mbox{vec}(\widehat{\textbf{Y}}')\) representation).</p></dd>

<dt><code>info</code> (<code>type="osqp"</code>)</dt>
<dd><p>matrix with some useful indicators (columns)
for each forecast horizon <em></em>\(h\) (rows): run time (<code>run_time</code>), number of iteration,
norm of primal residual (<code>pri_res</code>), status of osqp's solution (<code>status</code>) and
polish's status (<code>status_polish</code>).</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Considering contemporaneous and temporal dimensions in the
same framework requires to extend and adapt the notations
used in htsrec and thfrec.
To do that, we define the matrix containing the base forecasts
at any considered temporal frequency as
\[
\widehat{\textbf{Y}}_{n \times h(k^\ast+m))} =
\left[\begin{array}{ccccc}
\widehat{\textbf{A}}^{[m]} &amp; \widehat{\textbf{A}}^{[k_{p-1}]} &amp; \cdots &amp;
\widehat{\textbf{A}}^{[k_2]} &amp; \widehat{\textbf{A}}^{[1]} \cr
\widehat{\textbf{B}}^{[m]} &amp; \widehat{\textbf{B}}^{[k_{p-1}]} &amp; \cdots &amp;
\widehat{\textbf{B}}^{[k_2]} &amp; \widehat{\textbf{B}}^{[1]}
\end{array}
\right] \qquad k \in {\cal K},\]
where <em></em>\(\cal K\) is a subset of <em></em>\(p\) factors of <em></em>\(m\) and,
<em></em>\(\widehat{\textbf{B}}^{[k]}\) and <em></em>\(\widehat{\textbf{A}}^{[k]}\)
are the matrices containing the <em></em>\(k\)-order temporal aggregates of the
bts and uts, of dimension (<em></em>\(n_b \times h m/k\)) and
(<em></em>\(n_a \times h m/k\)), respectively.</p>
<p>Let us consider the multivariate regression model
\[\widehat{\mathbf{Y}} = \mathbf{Y} + \mathbf{E} ,\]
where the involved matrices have each dimension
<em></em>\([n \times (k^\ast+m)]\) and contain, respectively, the base
(<em></em>\(\widehat{\mathbf{Y}}\)) and the target forecasts
(<em></em>\(\mathbf{Y}\)), and the coherency errors (<em></em>\(\mathbf{E}\)) for
the <em></em>\(n\) component variables of the linearly constrained time series
of interest. For each variable, <em></em>\(k^\ast + m\) base forecasts are
available, pertaining to all aggregation levels of the temporal hierarchy
for a complete cycle of high-frequency observation, <em></em>\(m\). Consider
now two vectorized versions of model, by transforming the matrices either
in original form:
\[\mbox{vec}\left(\widehat{\mathbf{Y}}\right) =
\mbox{vec}\left(\mathbf{Y}\right) + \mathbf{\varepsilon} \; \mbox{ with }
\; \mathbf{\varepsilon} = \mbox{vec}\left(\mathbf{E}\right)\]
or in transposed form:
\[\mbox{vec}\left(\widehat{\mathbf{Y}}'\right) =
\mbox{vec}\left(\mathbf{Y}'\right) + \mathbf{\eta} \; \mbox{ with }
\; \mathbf{\eta} = \mbox{vec}\left(\mathbf{E}'\right).\]
Denote with <em></em>\(\mathbf{P}\) the <em></em>\([n(k^\ast+m) \times n(k^\ast+m)]\)
commutation matrix such that
<em></em>\(\mathbf{P}\mbox{vec}(\mathbf{Y}) = \mbox{vec}(\mathbf{Y}')\),
<em></em>\(\mathbf{P}\mbox{vec}(\widehat{\mathbf{Y}}) = \mbox{vec}(\widehat{\mathbf{Y}}')\)
and <em></em>\(\mathbf{P}\mathbf{\varepsilon} = {\bf \eta}\).
Let <em></em>\(\mathbf{W} = \mathrm{E}[\mathbf{\varepsilon\varepsilon}']\) be the
covariance matrix of vector <em></em>\(\mathbf{\varepsilon}\), and
<em></em>\(\mathbf{\Omega} = \mathrm{E}[\mathbf{\eta\eta}']\) the covariance matrix of
vector <em></em>\(\mathbf{\eta}\). Clearly, <em></em>\(\mathbf{W}\) and
<em></em>\(\mathbf{\Omega}\) are different parameterizations of the same
statistical object for which the following relationships hold:
\[\mathbf{\Omega} = \mathbf{P}\mathbf{W}\mathbf{P}',
\qquad \mathbf{W} = \mathbf{P}' \mathbf{\Omega}\mathbf{P} .\]
In order to apply the general point forecast reconciliation according to the
projection approach (<code>type = "M"</code>) to a cross-temporal forecast
reconciliation problem, we may consider either two <em>vec</em>-forms , e.g.
if we follow the first:
\[
\tilde{\mathbf{y}}= \hat{\mathbf{y}} - \mathbf{\Omega}\mathbf{H}\left(
\mathbf{H}'\mathbf{\Omega}\mathbf{H}\right)^{-1}\mathbf{H}'\hat{\mathbf{y}} =
{\mathbf{M}}\hat{\mathbf{y}},\]
where <em></em>\(\widehat{\mathbf{y}} = \mbox{vec}(\widehat{\mathbf{Y}}')\) is the
row vectorization of the base forecasts matrix <em></em>\(\widehat{\mathbf{Y}}\)
The alternative equivalent solution (<code>type = "S"</code>) (following the
structural reconciliation approach by Hyndman et al., 2011) is
\[\widetilde{\mathbf{y}} = \widetilde{\mathbf{S}}\left(\widetilde{\mathbf{S}}'
\mathbf{\Omega}^{-1}\widetilde{\mathbf{S}}\right)^{-1}\widetilde{\mathbf{S}}'
\mathbf{\Omega}^{-1}\widehat{\mathbf{y}} = \widetilde{\mathbf{S}}\mathbf{G}\widehat{\mathbf{y}}.\]
where <em></em>\(\widetilde{\mathbf{S}}\) is the cross-temporal summing matrix.</p>
<p><strong>Bounds on the reconciled forecasts</strong></p>
<p>When the reconciliation uses the optimization package osqp,
the user may impose bounds on the reconciled forecasts.
The parameter <code>bounds</code> permits to consider lower (<em></em>\(\mathbf{a}\)) and
upper (<em></em>\(\mathbf{b}\)) bounds like <em></em>\(\mathbf{a} \leq
\widetilde{\mathbf{y}} \leq \mathbf{b}\), where <em></em>\(\widehat{\mathbf{y}} =
\mbox{vec}(\widehat{\mathbf{Y}}')\), such that:
\[ \begin{array}{c}
a_1 \leq \widetilde{y}_1 \leq b_1 \cr
\dots \cr
a_{n(k^\ast + m)} \leq \widetilde{y}_{n(k^\ast + m)} \leq b_{n(k^\ast + m)} \cr
\end{array} \Rightarrow
\mbox{bounds} = [\mathbf{a} \; \mathbf{b}] =
\left[\begin{array}{cc}
a_1 &amp; b_1 \cr
\vdots &amp; \vdots \cr
a_{n(k^\ast + m)} &amp; b_{n(k^\ast + m)} \cr
\end{array}\right],\]
where <em></em>\(a_i \in [- \infty, + \infty]\) and <em></em>\(b_i \in [- \infty, + \infty]\).
If <em></em>\(y_i\) is unbounded, the i-th row of <code>bounds</code> would be equal
to <code>c(-Inf, +Inf)</code>.
Notice that if the <code>bounds</code> parameter is used, <code>sol = "osqp"</code> must be used.
This is not true in the case of non-negativity constraints:</p><ul><li><p><code>sol = "direct"</code>: first the base forecasts
  are reconciled without non-negativity constraints, then, if negative reconciled
  values are present, the <code>"osqp"</code> solver is used;</p></li>
<li><p><code>sol = "osqp"</code>: the base forecasts are
  reconciled using the <code>"osqp"</code> solver.</p></li>
</ul><p>In this case it is not necessary to build a matrix containing
the bounds, and it is sufficient to set <code>nn = "TRUE"</code>.</p>
<p>Non-negative reconciled forecasts may be obtained by setting <code>nn_type</code> alternatively as:</p><ul><li><p><code>nn_type = "sntz"</code> ("set-negative-to-zero")</p></li>
<li><p><code>nn_type = "osqp"</code> (Stellato et al., 2020)</p></li>
</ul></div>
    <div id="references">
    <h2>References</h2>
    <p>Byron, R.P. (1978), The estimation of large social accounts matrices,
<em>Journal of the Royal Statistical Society A</em>, 141, 3, 359-367.</p>
<p>Di Fonzo, T., and Girolimetto, D. (2023), Cross-temporal forecast reconciliation:
Optimal combination method and heuristic alternatives, <em>International Journal
of Forecasting</em>, 39(1), 39-57.</p>
<p>Girolimetto, D., Athanasopoulos, G., Di Fonzo, T., &amp; Hyndman, R. J. (2023),
Cross-temporal Probabilistic Forecast Reconciliation,
<a href="https://doi.org/10.48550/arXiv.2303.17277" class="external-link">doi:10.48550/arXiv.2303.17277</a>
.</p>
<p>Schäfer, J.L., Opgen-Rhein, R., Zuber, V., Ahdesmaki, M.,
Duarte Silva, A.P., Strimmer, K. (2017), <em>Package `corpcor'</em>, R
package version 1.6.9 (April 1, 2017), <a href="https://CRAN.R-project.org/package=corpcor" class="external-link">https://CRAN.R-project.org/package= corpcor</a>.</p>
<p>Schäfer, J.L., Strimmer, K. (2005), A Shrinkage Approach to Large-Scale Covariance
Matrix Estimation and Implications for Functional Genomics, <em>Statistical
Applications in Genetics and Molecular Biology</em>, 4, 1.</p>
<p>Stellato, B., Banjac, G., Goulart, P., Bemporad, A., Boyd, S. (2020). OSQP:
An Operator Splitting Solver for Quadratic Programs, <em>Mathematical Programming Computation</em>,
12, 4, 637-672.</p>
<p>Stellato, B., Banjac, G., Goulart, P., Boyd, S., Anderson, E. (2019), OSQP:
Quadratic Programming Solver using the `OSQP' Library, R package version 0.6.0.3
(October 10, 2019), <a href="https://CRAN.R-project.org/package=osqp" class="external-link">https://CRAN.R-project.org/package=osqp</a>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other reconciliation procedures: 
<code><a href="cstrec.html">cstrec</a>()</code>,
<code><a href="ctbu.html">ctbu</a>()</code>,
<code><a href="htsrec.html">htsrec</a>()</code>,
<code><a href="iterec.html">iterec</a>()</code>,
<code><a href="lccrec.html">lccrec</a>()</code>,
<code><a href="tcsrec.html">tcsrec</a>()</code>,
<code><a href="tdrec.html">tdrec</a>()</code>,
<code><a href="thfrec.html">thfrec</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">octrec</span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">$</span><span class="va">base</span>, m <span class="op">=</span> <span class="fl">12</span>, C <span class="op">=</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">C</span>,</span></span>
<span class="r-in"><span>              comb <span class="op">=</span> <span class="st">"bdshr"</span>, res <span class="op">=</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daniele Girolimetto, Tommaso Di Fonzo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>


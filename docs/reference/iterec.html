<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Iterative heuristic cross-temporal forecast reconciliation — iterec • FoReco026</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Iterative heuristic cross-temporal forecast reconciliation — iterec"><meta property="og:description" content="

Iterative procedure which produces cross-temporally reconciled
forecasts by alternating forecast reconciliation along one single dimension
(either cross-sectional or temporal) at each iteration step. Each iteration
consists in the first two steps of the heuristic procedure by Kourentzes and Athanasopoulos (2019),
so the forecasts are reconciled by alternating cross-sectional (contemporaneous) reconciliation,
and reconciliation through temporal hierarchies in a cyclic fashion.
The choice of the dimension along which the first reconciliation step in each
iteration is performed is up to the user (param start_rec), and there is
no particular reason why one should perform the temporal reconciliation first, and
the cross-sectional reconciliation then.
The iterative procedure allows the user to get non-negative reconciled forecasts."><meta property="og:image" content="https://danigiro.github.io/FoReco026/logo.svg"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">FoReco026</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.2.6.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
    Home
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-book"></span>
     
    Reference
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    <span class="fa fa-question-circle"></span>
     
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/FoReco_package.html">Using the FoReco package</a>
    </li>
    <li>
      <a href="../articles/accuracy_indices.html">Average relative accuracy indices</a>
    </li>
    <li>
      <a href="../articles/FoReco_prob.html">Probabilistic forecast reconciliation</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/daniGiro/FoReco" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://cran.r-project.org/web/packages/FoReco/index.html" class="external-link">
    <span class="fab fa-r-project fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Iterative heuristic cross-temporal forecast reconciliation</h1>
    <small class="dont-index">Source: <a href="https://github.com/daniGiro/FoReco026/blob/HEAD/R/iterec.R" class="external-link"><code>R/iterec.R</code></a></small>
    <div class="hidden name"><code>iterec.Rd</code></div>
    </div>

    <div class="ref-description">
    <p><script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script>

Iterative procedure which produces cross-temporally reconciled
forecasts by alternating forecast reconciliation along one single dimension
(either cross-sectional or temporal) at each iteration step. <strong>Each iteration</strong>
consists in the first two steps of the heuristic procedure by Kourentzes and Athanasopoulos (2019),
so the forecasts are reconciled by alternating cross-sectional (contemporaneous) reconciliation,
and reconciliation through temporal hierarchies in a cyclic fashion.
The choice of the dimension along which the first reconciliation step in each
iteration is performed is up to the user (param <code>start_rec</code>), and there is
no particular reason why one should perform the temporal reconciliation first, and
the cross-sectional reconciliation then.
The iterative procedure allows the user to get non-negative reconciled forecasts.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">iterec</span><span class="op">(</span><span class="va">basef</span>, <span class="va">thf_comb</span>, <span class="va">hts_comb</span>, <span class="va">res</span>, itmax <span class="op">=</span> <span class="fl">100</span>, tol <span class="op">=</span> <span class="fl">1e-5</span>,</span>
<span>       start_rec <span class="op">=</span> <span class="st">"thf"</span>, norm <span class="op">=</span> <span class="st">"inf"</span>, note <span class="op">=</span> <span class="cn">TRUE</span>, plot <span class="op">=</span> <span class="st">"mti"</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>basef</dt>
<dd><p>(<em></em>\(n \times h(k^\ast+m)\)) matrix of base forecasts to be
reconciled, <em></em>\(\widehat{\mathbf{Y}}\); <em></em>\(n\) is the total number of variables,
<em></em>\(m\) is the highest time frequency, <em></em>\(k^\ast\) is the sum of (a
subset of) (<em></em>\(p-1\)) factors of <em></em>\(m\), excluding <em></em>\(m\), and
<em></em>\(h\) is the forecast horizon for the lowest frequency time series.
Each row identifies a time series, and the forecasts are ordered as
[lowest_freq' ...  highest_freq']'.</p></dd>


<dt>hts_comb, thf_comb</dt>
<dd><p>Type of covariance matrix (respectively
(<em></em>\(n \times n\)) and (<em></em>\((k^\ast + m) \times (k^\ast + m)\))) to
be used in the cross-sectional and temporal reconciliation, see more in
<code>comb</code> param of <code><a href="htsrec.html">htsrec()</a></code> and
<code><a href="thfrec.html">thfrec()</a></code>.</p></dd>


<dt>res</dt>
<dd><p>(<em></em>\(n \times N(k^\ast + m)\)) matrix containing the residuals
at all the temporal frequencies ordered [lowest_freq' ...  highest_freq']'
(columns) for each variable (row), needed to estimate the covariance matrix
when <code>hts_comb =</code> <code>{"wls",</code> <code>"shr",</code> <code>"sam"}</code> and/or
<code>hts_comb =</code> <code>{"wlsv",</code> <code>"wlsh",</code> <code>"acov",</code>
<code>"strar1",</code> <code>"sar1",</code> <code>"har1",</code> <code>"shr",</code> <code>"sam"}</code>.
The row must be in the same order as <code>basef</code>.</p></dd>


<dt>itmax</dt>
<dd><p>Max number of iteration (<code>100</code>, <em>default</em>)
(old version <code>maxit</code>).</p></dd>


<dt>tol</dt>
<dd><p>Convergence tolerance (<code>1e-5</code>, <em>default</em>).</p></dd>


<dt>start_rec</dt>
<dd><p>Dimension along with the first reconciliation step in each
iteration is performed: it start from temporal reconciliation with
"<code>thf</code>" (<em>default</em>), from cross-sectional with "<code>hts</code>" and
it does both reconciliation with "<code>auto</code>".</p></dd>


<dt>norm</dt>
<dd><p>Norm used to calculate the temporal and the cross-sectional
incoherence. There are two alternatives: "<code>inf</code>" (<em></em>\(\max{|x_1|,
|x_2|,\dots}\), <em>default</em>) or "<code>one</code>" (<em></em>\(\sum |x_i|\)).</p></dd>


<dt>note</dt>
<dd><p>If <code>note = TRUE</code> (<em>default</em>) the function writes some
notes to the console, otherwise no note is produced (also no plot).</p></dd>


<dt>plot</dt>
<dd><p>Some useful plots: <code>"mti"</code> (<em>default</em>) marginal trend
inconsistencies, <code>"pat"</code> step by step inconsistency pattern for each
iteration, <code>"distf"</code> distance forecasts iteration i and i-1,
<code>"all"</code> all the plots.</p></dd>


<dt>...</dt>
<dd><p>any other options useful for <code><a href="htsrec.html">htsrec()</a></code> and
<code><a href="thfrec.html">thfrec()</a></code>, e.g. <code>m</code>, <code>C</code> (or <code>Ut</code> and
<code>nb</code>), <code>nn</code> (for non negativity reconciliation only at first step),
<code>mse</code>, <code>corpcor</code>, <code>type</code>, <code>sol</code>, <code>settings</code>,
<code>W</code>, <code>Omega</code>,...</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p><code>iterec</code> returns a list with:</p>
<dl><dt><code>recf</code></dt>
<dd><p>(<em></em>\(n \times h(k^\ast + m)\)) reconciled forecasts matrix, <em></em>\(\widetilde{\mathbf{Y}}\).</p></dd>

<dt><code>d_cs</code></dt>
<dd><p>Cross-sectional incoherence at each iteration.</p></dd>

<dt><code>d_te</code></dt>
<dd><p>Temporal incoherence at each iteration.</p></dd>

<dt><code>start_rec</code></dt>
<dd><p>Starting coherence dimension (thf or hts).</p></dd>

<dt><code>tol</code></dt>
<dd><p>Tolerance.</p></dd>

<dt><code>flag</code></dt>
<dd><p>Control code (see <em>details</em>).</p></dd>

<dt><code>time</code></dt>
<dd><p>Elapsed time.</p></dd>

<dt><code>dist</code></dt>
<dd><p>If <code>start_rec = "auto"</code>, matrix of distances of the forecasts reconciled
from the base.</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This reconciliation procedure can be seen as an extension of the well known iterative proportional
fitting procedure (Deming and Stephan, 1940, Johnston and Pattie, 1993), also known as
RAS method (Miller and Blair, 2009), to adjust the internal cell values of a
two-dimensional matrix until they sum to some predetermined row and column
totals. In that case the adjustment follows a proportional adjustment scheme, whereas
in the cross-temporal reconciliation framework each adjustment step is made according to
the penalty function associated to the single-dimension reconciliation procedure adopted.</p>
<p>Control status of iterative reconciliation:</p><dl><dt><code>-2</code></dt>
<dd><p>Temporal/Cross-sectional reconciliation does not work.</p></dd>

<dt><code>-1</code></dt>
<dd><p>Convergence not achieved (maximum iteration limit reached).</p></dd>

<dt><code>0</code></dt>
<dd><p>Convergence achieved.</p></dd>

<dt><code>+1</code></dt>
<dd><p>Convergence achieved: incoherence has increased in the next
iteration (at least one time).</p></dd>

<dt><code>+2</code></dt>
<dd><p>Convergence achieved: incoherence has increased in the next
two or more iteration (at least one time).</p></dd>

<dt><code>+3</code></dt>
<dd><p>The forecasts are already reconciled.</p></dd>


</dl></div>
    <div id="references">
    <h2>References</h2>
    <p>Deming, E., Stephan, F.F. (1940), On a least squares adjustment of a sampled frequency
table when the expected marginal totals are known, <em>The Annals of Mathematical
Statistics</em>, 11, 4, 427–444.</p>
<p>Di Fonzo, T., and Girolimetto, D. (2023), Cross-temporal forecast reconciliation:
Optimal combination method and heuristic alternatives, <em>International Journal
of Forecasting</em>, 39(1), 39-57.</p>
<p>Johnston, R.J., Pattie, C.J. (1993), Entropy-Maximizing and the Iterative Proportional
Fitting Procedure, <em>The Professional Geographer</em>, 45, 3, 317–322.</p>
<p>Kourentzes, N., Athanasopoulos, G. (2019), Cross-temporal coherent forecasts
for Australian tourism, <em>Annals of Tourism Research</em>, 75, 393-409.</p>
<p>Miller, R.E., Blair, P.D. (2009), Input-output analysis: foundations and extensions,
2nd edition, New York, Cambridge University Press.</p>
<p>Schäfer, J.L., Opgen-Rhein, R., Zuber, V., Ahdesmaki, M.,
Duarte Silva, A.P., Strimmer, K. (2017), <em>Package `corpcor'</em>, R
package version 1.6.9 (April 1, 2017),
<a href="https://CRAN.R-project.org/package=corpcor" class="external-link">https://CRAN.R-project.org/package= corpcor</a>.</p>
<p>Schäfer, J.L., Strimmer, K. (2005), A Shrinkage Approach to Large-Scale Covariance
Matrix Estimation and Implications for Functional Genomics, <em>Statistical
Applications in Genetics and Molecular Biology</em>, 4, 1.</p>
<p>Stellato, B., Banjac, G., Goulart, P., Bemporad, A., Boyd, S. (2020). OSQP:
An Operator Splitting Solver for Quadratic Programs, <em>Mathematical Programming Computation</em>,
12, 4, 637-672.</p>
<p>Stellato, B., Banjac, G., Goulart, P., Boyd, S., Anderson, E. (2019), OSQP:
Quadratic Programming Solver using the `OSQP' Library, R package version 0.6.0.3
(October 10, 2019), <a href="https://CRAN.R-project.org/package=osqp" class="external-link">https://CRAN.R-project.org/package=osqp</a>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p>Other reconciliation procedures: 
<code><a href="cstrec.html">cstrec</a>()</code>,
<code><a href="ctbu.html">ctbu</a>()</code>,
<code><a href="htsrec.html">htsrec</a>()</code>,
<code><a href="lccrec.html">lccrec</a>()</code>,
<code><a href="octrec.html">octrec</a>()</code>,
<code><a href="tcsrec.html">tcsrec</a>()</code>,
<code><a href="tdrec.html">tdrec</a>()</code>,
<code><a href="thfrec.html">thfrec</a>()</code></p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># \donttest{</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu">iterec</span><span class="op">(</span><span class="va">FoReco_data</span><span class="op">$</span><span class="va">base</span>, note <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>  m <span class="op">=</span> <span class="fl">12</span>, C <span class="op">=</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">C</span>, thf_comb <span class="op">=</span> <span class="st">"acov"</span>,</span></span>
<span class="r-in"><span>  hts_comb <span class="op">=</span> <span class="st">"shr"</span>, res <span class="op">=</span> <span class="va">FoReco_data</span><span class="op">$</span><span class="va">res</span>, start_rec <span class="op">=</span> <span class="st">"thf"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Daniele Girolimetto, Tommaso Di Fonzo.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

